# `eosws` Js/Ts bindings (from the [dfuse API](https://dfuse.io/))

WebSocket consumer for the <https://dfuse.io> API on EOS networks.

## Acknowledgement

A big thanks (and hug) to our dear friend [Denis Carriere](https://github.com/DenisCarriere) from
[EOS Nation](https://eosnation.io) for creating the initial version of this project.

## Quickstart

Available endpoints:

- **Mainnet** `wss://mainnet.eos.dfuse.io/v1/stream?token=[API TOKEN]`
- **Kylin** `wss://kylin.eos.dfuse.io/v1/stream?token=[API TOKEN]`

### Get Actions

```ts
import WebSocket from "ws"
import { get_actions, parse_actions } from "eosws"

const API_TOKEN = "eyJ...IBg"
const origin = "https://example.com"
const ws = new WebSocket(`wss://<SERVER>/v1/stream?token=${API_TOKEN}`, { origin })

ws.onopen = () => {
  ws.send(get_actions("eosio.token", "transfer"))
}

ws.onmessage = (message) => {
  const actions = parse_actions(message.data)

  if (actions) {
    const { from, to, quantity, memo } = actions.data.trace.act.data
    console.log(from, to, quantity, memo)
  }
}
```

### Get Table Rows

```ts
import { get_table_rows, parse_table_rows } from "eosws"

ws.onopen = () => {
  ws.send(get_table_rows("eosio", "eosio", "voters"))
}

ws.onmessage = (message) => {
  const table = parse_table_rows<Voters>(message.data, voters_req_id)

  if (table) {
    const { owner, producers, last_vote_weight } = table.data.row
    console.log(owner, producers, last_vote_weight)
  }
}
```

## Related Javascript

- WebSockets (<https://github.com/websockets/ws>)
- Socket.io (<https://github.com/socketio/socket.io>)

## Related Video

- Push Irreversible Transaction (<https://youtu.be/dO-Le3TTim0?t=34m6s>)

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

- [OptionalParams](#optionalparams)
  - [Properties](#properties)
- [get_actions](#get_actions)
  - [Parameters](#parameters)
  - [Examples](#examples)
- [get_transaction](#get_transaction)
  - [Parameters](#parameters-1)
  - [Examples](#examples-1)
- [get_table_rows](#get_table_rows)
  - [Parameters](#parameters-2)
  - [Examples](#examples-2)
- [unlisten](#unlisten)
  - [Parameters](#parameters-3)
  - [Examples](#examples-3)
- [generateReqId](#generatereqid)
  - [Examples](#examples-4)
- [parse_actions](#parse_actions)
  - [Parameters](#parameters-4)
  - [Examples](#examples-5)
- [parse_table_rows](#parse_table_rows)
  - [Parameters](#parameters-5)
  - [Examples](#examples-6)
- [parse_ping](#parse_ping)
  - [Parameters](#parameters-6)
  - [Examples](#examples-7)

### OptionalParams

Type: [Object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)

#### Properties

- `req_id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** An ID that you want sent back to you for any responses related to this request.
- `start_block` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Block at which you want to start processing.
  It can be an absolute block number, or a negative value, meaning how many blocks from the current head block on the chain.
  Ex: -2500 means 2500 blocks in the past, relative to the head block.
- `fetch` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Whether to fetch an initial snapshot of the requested entity.
- `with_progress` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** Frequency of the progress of blocks processing (within the scope of a req_id).
  You will, at a maximum, receive one notification each 250 milliseconds (when processing large amounts of blocks),
  and when blockNum % frequency == 0. When you receive a progress notification associated with a stream (again, identified by its req_id),
  you are guaranteed to have seen all messages produced by that stream, between the previous progress notification and the one received (inclusively).

### get_actions

Get Actions

#### Parameters

- `data` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Data Parameters
  - `data.account` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Contract account targeted by the action.
  - `data.receiver` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Specify the receiving account executing its smart contract.
    If left blank, defaults to the same value as `account`.
  - `data.action_name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Name of the action called within the account contract.
  - `data.with_ramops` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Stream RAM billing changes and reasons for costs of storage produced by each action.
  - `data.with_inline_traces` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Stream the inline actions produced by each action.
  - `data.with_deferred` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Stream the modifications to deferred transactions produced by each action.
- `options` **[OptionalParams](#optionalparams)** Optional Parameters (optional, default `{}`)

#### Examples

```javascript
ws.send(get_actions({ account: "eosio.token", action_name: "transfer" }))
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Message for `ws.send`

### get_transaction

Get Transaction

Retrieve a transaction and follow its life-cycle. BETA: some life-cycle events are still being rolled out.

#### Parameters

- `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** The transaction ID you're looking to track.
- `options` **[OptionalParams](#optionalparams)** Optional Parameters (optional, default `{}`)

#### Examples

```javascript
ws.send(get_transaction("517...86d"))
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Message for `ws.send`

### get_table_rows

Get Table Rows

Retrieve a stream of changes to the tables, as a side effect of transactions/actions being executed.

#### Parameters

- `data` **[object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object)** Data Parameters
  - `data.code` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Contract account which wrote to tables.
  - `data.scope` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Table scope where table is stored.
  - `data.table_name` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Table name, shown in the contract ABI.
  - `data.json` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** With json=true (or 1), table rows will be decoded to JSON, using the ABIs active on the queried block. This endpoint will thus automatically adapt to upgrades to the ABIs on chain. (optional, default `true`)
  - `data.verbose` **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?** Return the code, table_name, scope and key alongside each row.
- `options` **[OptionalParams](#optionalparams)** Optional parameters (optional, default `{}`)

#### Examples

```javascript
ws.send(get_table_rows({ code: "eosio", scope: "eosio", table_name: "global" }))
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Message for `ws.send`

### unlisten

Unlisten

To interrupt a stream, you can `unlisten` with the original `req_id`

#### Parameters

- `req_id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Request ID

#### Examples

```javascript
ws.send(unlisten("original-request-id"))
```

### generateReqId

Generate Req ID

#### Examples

```javascript
generateReqId() // => req123
```

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** Request ID

### parse_actions

Parse Actions from `get_actions` from WebSocket `onmessage` listener

#### Parameters

- `data` **WebSocketData** WebSocket Data from message event
- `req_id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Request ID

#### Examples

```javascript
const actions = parse_actions < any > message
```

Returns **ActionTrace** Action Trace

### parse_table_rows

Parse Table Deltas from `get_table_rows` from WebSocket `onmessage` listener

#### Parameters

- `data` **WebSocketData** WebSocket Data from message event
- `req_id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?** Request ID

#### Examples

```javascript
const table_deltas = parse_table_rows < any > message
```

Returns **ActionTrace** Action Trace

### parse_ping

Parse Ping from WebSocket `onmessage` listener

#### Parameters

- `data` **WebSocketData** WebSocket Data from message event

#### Examples

```javascript
const ping = parse_ping(message)
```

Returns **Ping** Ping
